/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

/**
 * Copyright 2012 Allen Institute for Brain Science Licensed under the
 * Apache License, Version 2.0 (the “License”); you may not use this
 * file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

define("scripts/items-carousel/collections/items-list",["underscore","backbone"],function(e,t){var n=t.Collection.extend({model:t.Model,initialize:function(){this.paginList=[],this.lastPosition=0},shiftItemsToPrevPage:function(e){this.shiftItems(-e)},shiftItemsToNextPage:function(e){this.shiftItems(e)},setPaginationData:function(e){var t,n;this.paginList=[];for(n=0;n<e;n++){if(this.isDataForOnePageOnly(e)&&n>=this.length)break;t=(this.lastPosition+n)%this.length,this.paginList[this.paginList.length]=this.at(t)}this.trigger("dataChanged")},shiftItems:function(e){var t=Math.abs(e),n;if(this.isDataForOnePageOnly(t))return;n=this.lastPosition+e,this.lastPosition=(n+this.length)%this.length,this.setPaginationData(t)},isDataForOnePageOnly:function(e){return e>=this.length},getPaginationData:function(){return this.paginList}});return n}),define("scripts/items-carousel/views/carousel-box",["jquery","underscore","backbone","hammer"],function(e,t,n,r){var i=n.View.extend({config:{oneItemSize:200,interval:7e3,minItemsNumber:4},events:{"click .carousel-nav .carousel-next":"slideNext","click .carousel-nav .carousel-prev":"slidePrev",mouseenter:"pause",mouseleave:"cycle"},initialize:function(){this.$itemsWrap=this.$el.find(".items-wrap"),this.pagin={totalPages:0,itemsPerPage:0},this.lastVisableItemsCount=0,this.config=t.defaults(this.options,this.config),window.Modernizr.touch&&this.attachTouchEvents()},initItemsAjaxBox:function(){var e=this.collection.at(0)||null,t,n;e&&(t=e.get("items"),n=e.get("title")||"",typeof n!="undefined"&&n!==""&&(this.$el.find("h2").remove(),this.$el.prepend("<h2>"+n+"</h2>")),typeof t!="undefined"&&this.collection.reset(t));if(this.collection.length<this.config.minItemsNumber){this.hideItemsBox();return}this.options.title&&this.$el.find("h2").text(this.options.title),this.initItemsBox(),this.slide(),this.$el.addClass("init")},initItemsBox:function(){this.setTotalPages(),this.setItemsDependOnScreenSize()},hideItemsBox:function(){this.$el.addClass("empty")},countMaxItemsPerPage:function(){var e=this.$itemsWrap.width()/this.config.oneItemSize;return Math.floor(e)},setItemsDependOnScreenSize:function(){this.setItemsPerPage(),e(window).on("resize",e.proxy(this.setItemsPerPage,this))},setItemsPerPage:function(){var e=this.countMaxItemsPerPage();this.pagin.itemsPerPage=e,this.setTotalPages(),this.collection.isDataForOnePageOnly(e)?this.$el.find(".carousel-nav a").addClass("inactive"):this.$el.find(".carousel-nav a").removeClass("inactive"),this.lastVisableItemsCount!==e&&(this.$el.removeClass("visible-"+this.lastVisableItemsCount),this.$el.addClass("visible-"+e),this.lastVisableItemsCount=e,this.slide())},setTotalPages:function(){this.pagin.totalPages=Math.ceil(this.collection.length/this.pagin.itemsPerPage)},slide:function(){this.collection.setPaginationData(this.pagin.itemsPerPage),this.cycle()},slideNext:function(e){if(this.paused&&!e)return;return this.collection.shiftItemsToNextPage(this.pagin.itemsPerPage),!1},slidePrev:function(e){return this.collection.shiftItemsToPrevPage(this.pagin.itemsPerPage),!1},cycle:function(){if(this.pagin.totalPages===1||this.config.interval===-1)return;this.paused=!1,clearInterval(this.interval),this.interval=setInterval(e.proxy(this.slideNext,this),this.config.interval)},pause:function(){this.paused=!0,clearInterval(this.interval)},attachTouchEvents:function(){r(this.el,{drag_min_distance:1,drag_block_horizontal:!0}).on("swipeleft",e.proxy(this.slideNext,this)),r(this.el,{drag_min_distance:1,drag_block_horizontal:!0}).on("swiperight",e.proxy(this.slidePrev,this))}});return i}),define("scripts/vela-layout/utils/number",["jquery","underscore"],function(e,t){return{parseDecimalInt:function(e){return parseInt(e,10)},numberFormat:function(e,t,n,r){if(isNaN(e)||e===null)return"";e=e.toFixed(t),r=typeof r=="string"?r:",";var i=e.split("."),s=i[0],o=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+o},formatPrice:function(e,n){t.extend({decimals:2,decimalSeparator:",",orderSeparator:" "},n);var r=this.numberFormat(e,n.decimals,n.decimalSeparator,n.orderSeparator);return r+" "+n.currency}}}),define("scripts/vela-layout/utils/visual",["jquery"],function(e){return{scrollTo:function(t,n){e("html, body").animate({scrollTop:e(t).offset().top},n||500)}}}),define("scripts/vela-layout/utils/main",["scripts/vela-layout/utils/number","scripts/vela-layout/utils/visual"],function(e,t){return{number:e,visual:t}}),define("scripts/items-carousel/views/slide",["jquery","underscore","backbone","scripts/vela-layout/utils/main"],function(e,t,n,r){var i,s;return i=n.View.extend({initialize:function(e){this.template=t.template(e.template)},render:function(){var e={};return this.options.priceFormat&&(e.utils=r.number,e.priceFormat=this.options.priceFormat),this.setElement(this.template(t.extend(this.model.toJSON(),e))),this}}),s=n.View.extend({initialize:function(){this.collection.on("dataChanged",this.slide,this)},renderItem:function(e){var t=new i({model:e,template:this.options.itemTemplate,priceFormat:this.options.priceFormat});return t.render()},renderList:function(){var t=this.collection.getPaginationData(),n,r=e();for(n=0;n<t.length;n++)r=r.add(this.renderItem(t[n]).$el);return r},slide:function(){var e=this.$el.find(".items-wrap"),t=400,n;n=this.renderList(),e.hide().empty().append(n).fadeIn(t)}}),s}),function(e){typeof define=="function"&&define.amd?define("libs/jquery.cookie",["jquery"],e):e(jQuery)}(function(e){function n(e){if(i.raw)return e;try{return decodeURIComponent(e.replace(t," "))}catch(n){}}function r(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e=n(e);try{return i.json?JSON.parse(e):e}catch(t){}}var t=/\+/g,i=e.cookie=function(t,s,o){if(s!==undefined){o=e.extend({},i.defaults,o);if(typeof o.expires=="number"){var u=o.expires,a=o.expires=new Date;a.setDate(a.getDate()+u)}return s=i.json?JSON.stringify(s):String(s),document.cookie=[i.raw?t:encodeURIComponent(t),"=",i.raw?s:encodeURIComponent(s),o.expires?"; expires="+o.expires.toUTCString():"",o.path?"; path="+o.path:"",o.domain?"; domain="+o.domain:"",o.secure?"; secure":""].join("")}var f=t?undefined:{},l=document.cookie?document.cookie.split("; "):[];for(var c=0,h=l.length;c<h;c++){var p=l[c].split("="),d=n(p.shift()),v=p.join("=");if(t&&t===d){f=r(v);break}!t&&(v=r(v))!==undefined&&(f[d]=v)}return f};i.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==undefined?(e.cookie(t,"",e.extend({},n,{expires:-1})),!0):!1}}),function(e){window.XDomainRequest&&e.ajaxTransport(function(t){if(t.crossDomain&&t.async){t.timeout&&(t.xdrTimeout=t.timeout,delete t.timeout);var n;return{send:function(r,i){function o(t,r,s,o){n.onload=n.onerror=n.ontimeout=e.noop,n=undefined,i(t,r,s,o)}n=new window.XDomainRequest,n.onload=function(){o(200,"OK",{text:n.responseText},"Content-Type: "+n.contentType)},n.onerror=function(){o(404,"Not Found")},n.onprogress=function(){},t.xdrTimeout&&(n.ontimeout=function(){o(0,"timeout")},n.timeout=t.xdrTimeout),n.open(t.type,t.url,!0),n.send(t.hasContent&&t.data||null)},abort:function(){n&&(n.onerror=e.noop(),n.abort())}}}})}(jQuery),define("libs/jquery.ie.cors",function(){}),define("scripts/items-carousel/recommended",["jquery","underscore","scripts/items-carousel/collections/items-list","scripts/items-carousel/views/carousel-box","scripts/items-carousel/views/slide","libs/jquery.cookie","libs/jquery.ie.cors"],function(e,t,n,r,i){var s=function(t){this.options=t,this.options.priceFormat={decimals:2,decimalSeparator:",",orderSeparator:" ",currency:"zł"},this.slotId=null,this.ruleId=null,this.clusters=[],this.options.elementId?(this.options.elements={$list:e("#items-carousel-"+t.elementId),listItemTemplate:e("#items-carousel-template-"+t.elementId).html()},this.options.el=e("#items-carousel-"+t.elementId)):this.options.el=t.elements.$list};return s.prototype={init:function(){this.fetchData()},fetchData:function(){var t=this.options.url||this.getUrlFromHTMLData(),n=this.getItemsFromStorage();if(!t)return this.renderError();e.ajax(t,{type:"post",dataType:"json",data:n,success:e.proxy(this.dataLoaded,this),error:e.proxy(this.renderError,this)})},getUrlFromHTMLData:function(){var t=e("#items-carousel-"+this.options.elementId).data("url"),n=/uHash/;return n.test(t)?t:t+="&uHash="+(e.cookie("ws3")||"")},getItemsFromStorage:function(){var t,n,r,i=e.cookie("qeppo_login2")?JSON.parse(e.cookie("qeppo_login2")).id:"";return t=JSON.parse(localStorage.getItem("allActions"))||{},n=JSON.parse(e.cookie("qeppo_login2")||null),r={visited:JSON.stringify(this.clearNonFirstItems(t.visited||[])),cart:JSON.stringify(this.clearNonFirstItems(t.cart||[])),watched:JSON.stringify(this.clearNonFirstItems(n&&t[i]||[]))},r},clearNonFirstItems:function(e){var n,r;if(!t.isArray(e))return this.renderError();n=e.length;for(r=1;r<n;r++)e[r]=t.omit(e[r],["name","photoLink"]);return e},dataLoaded:function(t){var r,s;r=new n,s=new i({el:this.options.elements.$list,itemTemplate:this.options.elements.listItemTemplate,collection:r,priceFormat:this.options.priceFormat});if(!e.isArray(t)||!t.length)return this.renderError();t=t[0],t.items&&t.items.length?(r.add(this.parseItems(t)),this.renderSuccess({el:this.options.elements.$list,collection:r,title:t.slogan||null})):this.renderError()},renderSuccess:function(e){var t=new r(e);t.initItemsAjaxBox(),this.firstTimeShowAction()},renderError:function(){var e=new r({el:this.options.elements.$list});e.hideItemsBox()},parseItems:function(t){var n,r;this.slotId=t.slotId,this.ruleId=t.ruleId;if((!e.isArray(t)||!t.length)&&t.items&&t.items.length){for(n=0,r=t.items.length;n<r;n++)t.items[n].ruleId=t.ruleId,t.items[n].socketId=t.slotId,this.clusters[this.clusters.length]=t.items[n].clusterId;return t.items}return!1},firstTimeShowAction:function(){var t={offsetTop:e(this.options.el).offset().top,height:e(this.options.el).height()};e(window).on("scroll.carousel",e.proxy(this.processScroll,this,t)),e(window).trigger("scroll.carousel")},processScroll:function(t){var n=t.offsetTop+t.height/2,r=e(window).height()+e(window).scrollTop(),i;if(n<=r){try{typeof window.cm!="undefined"&&(i=[this.slotId,this.ruleId,this.clusters.join("|")],window.cm.event({cat:"ars",a:"show",v:i.join(";")}))}catch(s){window.console.info("Fail to log cookie monster event when recommendation box is visible")}e(window).off("scroll.carousel")}}},s}),define("main",["scripts/items-carousel/recommended"],function(e){var t=new e({elementId:"recommended"});t.init()});